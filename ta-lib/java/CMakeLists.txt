
include("${ta-lib_SOURCE_DIR}/cmake/OpenCVDetectApacheAnt.cmake")

find_jar(JUNIT_JAR "junit4")

IF(JUNIT_JAR-NOTFOUND)
    SET(MAVEN_REMOTE_REPOS "https://repo1.maven.org/maven2")
    SET(JUNIT_JAR_VERSION "4.13")
    file(DOWNLOAD ${MAVEN_REMOTE_REPOS}/junit/junit/${JUNIT_JAR_VERSION}/junit-${JUNIT_JAR_VERSION}.jar.asc.sha1 JUNIT_JAR_FILE_SHA)
    file(READ ${JUNIT_JAR_FILE_SHA} JUNIT_JAR_SHA)
    file(DOWNLOAD ${MAVEN_REMOTE_REPOS}/junit/junit/${JUNIT_JAR_VERSION}/junit-${JUNIT_JAR_VERSION}.jar 
        EXPECTED_HASH SHA1=${JUNIT_JAR_SHA}
        JUNIT_JAR)
ENDIF(JUNIT_JAR-NOTFOUND)

message(STATUS ${JUNIT_JAR})

SET(TA_LIB_JAVA_BASEDIR "${ta-lib_SOURCE_DIR}/java")
SET(TA_LIB_JAVA_BASE_SOURCEDIR "${TA_LIB_JAVA_BASEDIR}/src")
#set(TA_LIB_JAVA_PACKAGEDIR "meta/com/tictactec/ta/lib") 
#SET(TA_LIB_JAVA_SOURCEDIR "${TA_LIB_JAVA_BASE_SOURCEDIR}/${meta/com/tictactec/ta/lib}")

SET(TA_LIB_JAR_TARGET_NAME "${PROJECT_NAME}-${TA_LIB_VERSION_FULL}")
SET(TA_LIB_JAVA_SOURCE_VERSION ${JAVA_SOURCE_VERSION})
SET(TA_LIB_JAVA_TARGET_VERSION ${JAVA_SOURCE_VERSION})

configure_file(${TA_LIB_JAVA_BASEDIR}/build.xml.in ${ta-lib_BINARY_DIR}/build.xml)

ADD_CUSTOM_TARGET( ant_build ALL )
ADD_CUSTOM_COMMAND(
    TARGET  ant_build
    COMMAND ${ANT_EXECUTABLE} 
    WORKING_DIRECTORY ${ta-lib_BINARY_DIR}
)

IF(TA_LIB_ENABLE_TESTS)
    set(TA_LIB_CLASSPATH_TEST "${ta-lib_BINARY_DIR}/${TA_LIB_JAR_TARGET_NAME}-test.jar:${JUNIT_JAR}:${ta-lib_BINARY_DIR}/lib-java/${TA_LIB_JAR_TARGET_NAME}.jar")
    add_test(NAME ta-lib_jar COMMAND ${Java_JAVA_EXECUTABLE} -cp ${TA_LIB_CLASSPATH_TEST} com.tictactec.ta.lib.test.AllTests)
ENDIF(TA_LIB_ENABLE_TESTS)